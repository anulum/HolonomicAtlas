<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCPN Layer 3: An Interactive Manuscript</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cool Neutrals & Purples -->
    <!-- Application Structure Plan: A thematic journey into Layer 3, showing DNA's role beyond simple genetics. The flow is: 1. Introduction to DNA as a field-coupled antenna. 2. A DNA Torsion Field simulator to visualize how physical stress on DNA creates resonant fractal patterns. 3. An interactive diagram of Epigenetic Phase Switches, showing how entropy gradients (field influence) can alter gene expression. 4. An abstract simulation of Embryogenesis, demonstrating how a guiding Ψ-field preserves symmetry during development. 5. An explanation of the core Encoding Equation. 6. A diagram of inter-layer connections. This structure makes the abstract concepts of morphogenetic fields and geometric DNA logic tangible and interactive. -->
    <!-- Visualization & Content Choices:
        - DNA Torsion & Fractals: Goal: Visualize DNA's physical response to fields. Method: Canvas animation. Interaction: A slider controls DNA "torsion," which dynamically alters an adjacent fractal pattern generated by an L-system. Justification: Directly connects a physical action (twisting) to a metaphysical concept (resonant fractals).
        - Epigenetic Phase Switches: Goal: Demonstrate field influence on gene expression. Method: Interactive Canvas diagram. Interaction: Buttons for "Low Entropy" and "High Entropy" states toggle methylation markers (dots) on a gene, changing its visual "expression" (glow). Justification: A clear, simple visual metaphor for the complex process of epigenetic modulation.
        - Embryogenesis Simulation: Goal: Illustrate the concept of a symmetry-preserving guiding field. Method: Abstract Canvas animation. Interaction: A slider for "Ψ-Field Guidance" makes a fractal cell division process more orderly and symmetrical. Justification: Avoids biological complexity while effectively communicating the core principle of guided morphogenesis.
        - Inter-Layer Diagram: Goal: Contextualize Layer 3. Method: Static HTML/Tailwind diagram. Justification: Shows the flow of influence from neurochemistry (L2) and conscious feedback (L5) to genetics (L3) and cellular organization (L4).
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .nav-link { transition: color 0.3s ease; }
        .nav-link:hover, .nav-link.active { color: #7c3aed; }
        .section-card { background-color: white; border-radius: 0.75rem; padding: 2rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); margin-bottom: 3rem; scroll-margin-top: 5rem; }
        .control-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #e2e8f0; border-radius: 5px; outline: none; opacity: 0.7; transition: opacity .2s; }
        .control-slider:hover { opacity: 1; }
        .control-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #7c3aed; border-radius: 50%; cursor: pointer; }
        .control-slider::-moz-range-thumb { width: 20px; height: 20px; background: #7c3aed; border-radius: 50%; cursor: pointer; }
        .interactive-toggle button.active { background-color: #7c3aed; color: white; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/90 backdrop-blur-sm sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-slate-900">SCPN Layer 3: Genomics & Morphogenesis</h1>
            <div class="hidden md:flex items-center space-x-8">
                 <a href="https://anulum.li/scpn.html" class="px-3 py-1.5 border-2 border-slate-300 rounded-md text-sm font-semibold text-slate-600 hover:bg-slate-100 hover:text-slate-800 transition-colors">Back to Overview</a>
                <div class="flex space-x-6">
                    <a href="#introduction" class="nav-link font-semibold text-slate-600">Introduction</a>
                    <a href="#torsion" class="nav-link font-semibold text-slate-600">Torsion Fields</a>
                    <a href="#epigenetics" class="nav-link font-semibold text-slate-600">Epigenetics</a>
                    <a href="#embryogenesis" class="nav-link font-semibold text-slate-600">Embryogenesis</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="introduction" class="section-card text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">DNA: The Geometric Antenna of Life</h2>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">
                Layer 3 explores the genome as more than a chemical blueprint. It is a dynamic, geometric structure that couples with external field memory. Through torsion fields, epigenetic switches, and guided morphogenesis, DNA acts as an antenna, translating the phase information of the Ψ-field into the physical structure of life.
            </p>
        </section>

        <section id="torsion" class="section-card">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">DNA Torsion Fields & Resonant Fractals</h2>
                <p class="max-w-3xl mx-auto text-slate-600">Physical stress and field interactions cause the DNA helix to twist and bend. This "torsion" generates complex mechanical and electromagnetic fields that resonate with geometric fractals, coupling the genetic code to the symbolic information in the Ψ-field. Adjust the torsion to see the resonant fractal change.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-black rounded-lg p-4">
                    <canvas id="torsionCanvas" class="w-full h-80"></canvas>
                </div>
                <div>
                    <label for="torsion-slider" class="font-semibold text-slate-700">DNA Torsional Stress: <span id="torsion-value">22</span>°</label>
                    <p class="text-sm text-slate-500 mb-2">Increase the twisting force on the DNA helix.</p>
                    <input type="range" min="15" max="30" value="22" step="0.1" class="control-slider" id="torsion-slider">
                </div>
            </div>
        </section>
        
        <section id="epigenetics" class="section-card">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Epigenetic Phase Switches</h2>
                <p class="max-w-3xl mx-auto text-slate-600">Gene expression is not fixed. Epigenetic markers, acting like switches, are modulated by entropy gradients in the cellular environment, which are in turn influenced by the Ψ-field. A coherent, low-entropy state (e.g., meditation) can activate beneficial genes, while a high-entropy state (e.g., stress) can silence them.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-black rounded-lg p-4">
                     <canvas id="epigeneticCanvas" class="w-full h-64"></canvas>
                </div>
                <div class="flex justify-center">
                    <div class="interactive-toggle inline-flex rounded-md shadow-sm" role="group">
                        <button type="button" id="btn-low-entropy" class="active rounded-l-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-900 hover:bg-slate-100">
                            Low Entropy (Coherent State)
                        </button>
                        <button type="button" id="btn-high-entropy" class="rounded-r-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-900 hover:bg-slate-100">
                            High Entropy (Stress State)
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="embryogenesis" class="section-card">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Embryogenesis as Field Traversal</h2>
                <p class="max-w-3xl mx-auto text-slate-600">The development of an organism is a symmetry-preserving traversal of a morphogenetic field. The Ψ-field provides a guiding influence, ensuring that the chaotic process of cell division unfolds into an ordered, symmetrical, and coherent life form.</p>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-black rounded-lg p-4">
                    <canvas id="embryoCanvas" class="w-full h-80"></canvas>
                </div>
                <div>
                    <label for="guidance-slider" class="font-semibold text-slate-700">Ψ-Field Guidance: <span id="guidance-value">0</span>%</label>
                    <p class="text-sm text-slate-500 mb-2">Increase the strength of the guiding field to promote more symmetrical and orderly development.</p>
                    <input type="range" min="0" max="100" value="0" class="control-slider" id="guidance-slider">
                    <button id="reset-embryo-btn" class="mt-4 px-4 py-2 bg-slate-200 rounded-md font-semibold hover:bg-slate-300 w-full">Reset Simulation</button>
                </div>
            </div>
        </section>

    </main>
    
    <script>
        // --- DNA Torsion Fields & Resonant Fractals ---
        const torsionCanvas = document.getElementById('torsionCanvas');
        const torsionCtx = torsionCanvas.getContext('2d');
        const torsionSlider = document.getElementById('torsion-slider');
        const torsionValue = document.getElementById('torsion-value');
        let torsionTime = 0;

        function drawLSystem(ctx, rules, axiom, iterations, angle, length) {
            let currentString = axiom;
            for (let i = 0; i < iterations; i++) {
                let nextString = '';
                for (let char of currentString) {
                    nextString += rules[char] || char;
                }
                currentString = nextString;
            }

            ctx.save();
            ctx.strokeStyle = '#a78bfa';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for (let char of currentString) {
                if (char === 'F') {
                    ctx.moveTo(0, 0);
                    ctx.lineTo(0, -length);
                    ctx.translate(0, -length);
                } else if (char === '+') {
                    ctx.rotate(angle * Math.PI / 180);
                } else if (char === '-') {
                    ctx.rotate(-angle * Math.PI / 180);
                } else if (char === '[') {
                    ctx.save();
                } else if (char === ']') {
                    ctx.restore();
                }
            }
            ctx.stroke();
            ctx.restore();
        }

        function animateTorsion() {
            const w = torsionCanvas.width;
            const h = torsionCanvas.height;
            torsionCtx.clearRect(0, 0, w, h);
            torsionTime += 0.02;
            const angle = parseFloat(torsionSlider.value);
            torsionValue.textContent = `${angle.toFixed(1)}°`;

            // Draw DNA Helix
            torsionCtx.save();
            torsionCtx.translate(w * 0.25, h / 2);
            torsionCtx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
            torsionCtx.lineWidth = 2;
            for (let i = 0; i < 100; i++) {
                const y = (i - 50) * 4;
                const x1 = Math.sin(i * 0.2 + torsionTime * (angle/22)) * 20;
                const x2 = Math.cos(i * 0.2 + torsionTime * (angle/22)) * 20;
                torsionCtx.beginPath();
                torsionCtx.moveTo(x1, y);
                torsionCtx.lineTo(x2, y);
                torsionCtx.stroke();
            }
            torsionCtx.restore();

            // Draw Fractal
            torsionCtx.save();
            torsionCtx.translate(w * 0.7, h * 0.9);
            const rules = { 'F': 'FF-[-F+F+F]+[+F-F-F]' };
            drawLSystem(torsionCtx, rules, 'F', 3, angle, 10);
            torsionCtx.restore();

            requestAnimationFrame(animateTorsion);
        }

        // --- Epigenetic Phase Switches ---
        const epigeneticCanvas = document.getElementById('epigeneticCanvas');
        const epigeneticCtx = epigeneticCanvas.getContext('2d');
        const btnLowEntropy = document.getElementById('btn-low-entropy');
        const btnHighEntropy = document.getElementById('btn-high-entropy');
        let epigeneticState = 'low';
        let markers = [];

        function initEpigenetics() {
            for(let i=0; i<10; i++) {
                markers.push({ active: Math.random() > 0.5, targetAlpha: 0 });
            }
        }

        function animateEpigenetics() {
            const w = epigeneticCanvas.width;
            const h = epigeneticCanvas.height;
            epigeneticCtx.clearRect(0, 0, w, h);

            const geneX = w * 0.1, geneY = h / 2, geneW = w * 0.8, geneH = 40;
            
            // Draw Gene Body
            let expressionLevel = 0;
            markers.forEach(m => {
                m.targetAlpha = (epigeneticState === 'low' && m.active) ? 0 : (epigeneticState === 'high' && m.active) ? 1 : m.targetAlpha;
                if (!m.active) expressionLevel += 0.1;
            });
            
            const glow = `rgba(167, 139, 250, ${expressionLevel * 0.7})`;
            epigeneticCtx.fillStyle = '#475569';
            epigeneticCtx.shadowBlur = 20;
            epigeneticCtx.shadowColor = glow;
            epigeneticCtx.fillRect(geneX, geneY - geneH/2, geneW, geneH);
            epigeneticCtx.shadowBlur = 0;

            // Draw Markers
            for(let i=0; i<10; i++) {
                if (markers[i].active) {
                    const alpha = (epigeneticState === 'low') ? 0.1 : 0.8;
                    epigeneticCtx.fillStyle = `rgba(239, 68, 68, ${alpha})`;
                    epigeneticCtx.beginPath();
                    epigeneticCtx.arc(geneX + (i + 0.5) * (geneW / 10), geneY - geneH/2 - 10, 5, 0, Math.PI * 2);
                    epigeneticCtx.fill();
                }
            }
            requestAnimationFrame(animateEpigenetics);
        }
        btnLowEntropy.addEventListener('click', () => {
            epigeneticState = 'low';
            btnLowEntropy.classList.add('active');
            btnHighEntropy.classList.remove('active');
        });
        btnHighEntropy.addEventListener('click', () => {
            epigeneticState = 'high';
            btnHighEntropy.classList.add('active');
            btnLowEntropy.classList.remove('active');
        });

        // --- Embryogenesis Simulation ---
        const embryoCanvas = document.getElementById('embryoCanvas');
        const embryoCtx = embryoCanvas.getContext('2d');
        const guidanceSlider = document.getElementById('guidance-slider');
        const guidanceValue = document.getElementById('guidance-value');
        const resetEmbryoBtn = document.getElementById('reset-embryo-btn');
        let embryoSystem;

        function createEmbryoSystem() {
            return {
                axiom: 'X',
                rules: { 'X': 'F+[[X]-X]-F[-FX]+X', 'F': 'FF' },
                angle: 25,
                iterations: 0,
                maxIterations: 5,
                interval: null
            };
        }

        function drawEmbryo() {
            const w = embryoCanvas.width;
            const h = embryoCanvas.height;
            embryoCtx.clearRect(0, 0, w, h);
            embryoCtx.save();
            embryoCtx.translate(w / 2, h);
            
            const guidance = parseInt(guidanceSlider.value) / 100;
            guidanceValue.textContent = `${Math.round(guidance*100)}%`;
            const angleNoise = (1 - guidance) * 5;
            const lengthNoise = (1 - guidance) * 2;

            let currentString = embryoSystem.axiom;
            for (let i = 0; i < embryoSystem.iterations; i++) {
                let nextString = '';
                for (let char of currentString) {
                    nextString += embryoSystem.rules[char] || char;
                }
                currentString = nextString;
            }

            embryoCtx.strokeStyle = '#a78bfa';
            embryoCtx.lineWidth = 1.5;
            embryoCtx.beginPath();
            for (let char of currentString) {
                if (char === 'F') {
                    const length = 5 + (Math.random() - 0.5) * lengthNoise;
                    embryoCtx.moveTo(0, 0);
                    embryoCtx.lineTo(0, -length);
                    embryoCtx.translate(0, -length);
                } else if (char === '+') {
                    const angle = embryoSystem.angle + (Math.random() - 0.5) * angleNoise;
                    embryoCtx.rotate(angle * Math.PI / 180);
                } else if (char === '-') {
                    const angle = embryoSystem.angle + (Math.random() - 0.5) * angleNoise;
                    embryoCtx.rotate(-angle * Math.PI / 180);
                } else if (char === '[') {
                    embryoCtx.save();
                } else if (char === ']') {
                    embryoCtx.restore();
                }
            }
            embryoCtx.stroke();
            embryoCtx.restore();
        }

        function startEmbryoSimulation() {
            if (embryoSystem.interval) clearInterval(embryoSystem.interval);
            embryoSystem.interval = setInterval(() => {
                if (embryoSystem.iterations < embryoSystem.maxIterations) {
                    embryoSystem.iterations++;
                    drawEmbryo();
                } else {
                    clearInterval(embryoSystem.interval);
                }
            }, 1000);
        }

        resetEmbryoBtn.addEventListener('click', () => {
            embryoSystem = createEmbryoSystem();
            drawEmbryo();
            startEmbryoSimulation();
        });

        // --- Window Onload ---
        window.onload = function() {
            torsionCanvas.width = torsionCanvas.offsetWidth;
            torsionCanvas.height = torsionCanvas.offsetHeight;
            animateTorsion();

            epigeneticCanvas.width = epigeneticCanvas.offsetWidth;
            epigeneticCanvas.height = epigeneticCanvas.offsetHeight;
            initEpigenetics();
            animateEpigenetics();

            embryoCanvas.width = embryoCanvas.offsetWidth;
            embryoCanvas.height = embryoCanvas.offsetHeight;
            embryoSystem = createEmbryoSystem();
            drawEmbryo();
            startEmbryoSimulation();
        };
    </script>
</body>
</html>
