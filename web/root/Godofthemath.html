import React, { useState, useEffect, useRef } from 'react';

// --- ICONS (as inline SVGs for portability) ---
const MenuIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7" />
  </svg>
);

const CloseIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
);

const ArrowRightIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
    </svg>
);

// --- HIERARCHICAL MANUSCRIPT DATA ---
// Note: Content now includes LaTeX blocks with $$...$$
const manuscriptContent = [
    {
        id: 'part-1',
        title: 'Part I: Foundational Physics Reimagined',
        chapters: [
            {
                id: 'ch-1',
                title: 'Chapter 1: The Consciousness Field',
                sections: [
                    { id: 'consciousness-field', title: '1.1 The Ψ-Field Postulate', content: `<p>The central postulate of this model is that consciousness is not an epiphenomenon but is instead a fundamental, irreducible field, as primary as gravity or electromagnetism. We denote this field as [[term:Ψ-Field (Psi-Field)]].</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Properties of the Ψ-Field</h3><p>Unlike other fields, the Ψ-field is characterized by [[term:Qualia]] and intentionality. Its interaction with the spacetime manifold is what gives rise to localized, subjective experience. It is both the canvas of perception and the brush that paints reality.</p><ul class="list-disc list-inside space-y-2 mt-4 text-slate-400"><li><strong>[[term:Non-locality]]:</strong> The field is inherently non-local, providing a potential mechanism for phenomena like quantum entanglement.</li><li><strong>Interactive:</strong> It doesn't just observe; it interacts. The field's state directly influences the metric tensor of spacetime.</li><li><strong>Source of Information:</strong> The Ψ-field is proposed as the source of novel information entering the universe, acting as a counter-agent to entropy.</li></ul>` },
                    { id: 'emergent-gravity', title: '1.2 Gravity as an Emergent Effect', content: `<p>In contrast to the standard model, this framework proposes that [[term:Emergent Gravity]] is the macroscopic effect of the [[term:Ψ-Field (Psi-Field)]] interacting with and distorting the underlying [[link:fractal-geometry|fractal geometry of spacetime]].</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">The Mechanism of Emergence</h3><p>Imagine the fractal geometry as a perfectly taut web. The presence of a conscious observer creates a depression, a local curvature. The extended field equations are modified to include this influence directly.</p><div class="my-6">$$R_{\\mu\\nu} - \\frac{1}{2} R g_{\\mu\\nu} = \\frac{8\\pi G}{c^4} T_{\\mu\\nu} + \\Lambda_{\\mu\\nu}(\\psi)$$</div><p>Here, the new term, $\\Lambda_{\\mu\\nu}(\\psi)$, represents the contribution of the consciousness field to the curvature of spacetime. This term is not a cosmological constant, but a dynamic tensor that varies with the local intensity and coherence of the Ψ-field.</p><div class="figure-placeholder my-8"><p class="font-semibold">Figure 1.2: Spacetime Curvature</p><p>A 2D representation of the spacetime fabric. The large depression is caused by a massive object (Tμν), while the smaller, localized distortions are generated by the presence of conscious observers (Λμν(ψ)).</p></div>` },
                    { id: 'psi-quantum', title: '1.3 The Ψ-Field and Quantum Mechanics', content: `<p>The [[term:Observer Effect]] in quantum mechanics, where the act of measurement appears to collapse a wave function, is one of the most profound mysteries in physics. This model proposes that the Ψ-field provides a physical, rather than purely philosophical, explanation for this phenomenon.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Measurement as Interaction</h3><p>The "observer" is not a disembodied concept but a localized, coherent region of the [[term:Ψ-Field (Psi-Field)]]. The act of measurement is a direct physical interaction between the Ψ-field of the observer and the quantum system's wave function. This interaction breaks the superposition and forces a collapse into a definite state.</p><p>This provides a potential mechanism for the Born rule, where the probability of collapsing into a particular state $|\\phi_i\\rangle$ is given by the square of the amplitude, $|c_i|^2$. The interaction strength between the observer's Ψ-field and each potential state could be what determines these probabilities.</p>` },
                ]
            },
            {
                id: 'ch-2',
                title: 'Chapter 2: The Nature of Spacetime',
                sections: [
                     { id: 'fractal-geometry', title: '2.1 Fractal Geometry & Metatron\'s Cube', content: `<p>The premise that the universe is fundamentally geometric is not new. At the core of this is [[term:Metatron's Cube]], not as a static symbol, but as a generative engine for dimensional space. This geometry is inherently fractal, meaning its structure is self-similar at all scales, from the Planck length to the cosmic web.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">From Geometry to Physics</h3><p>The projection from higher-dimensional geometric forms to our familiar 3D+1 spacetime gives rise to physical laws and particles. The rules of this projection are governed by the cosmic language, [[link:vibrana|VIBRANA]]. The metric tensor $g_{\\mu\\nu}$, which defines distance and curvature, is thus a function of the underlying geometric state $G_{ij}$ and its modulation by the [[term:Ψ-Field (Psi-Field)]].</p><div class="my-6">$$g_{\\mu\\nu} = \\mathcal{P}(G_{ij}) \\otimes \\Psi$$</div><p>Where $\\mathcal{P}$ is a projection operator. This implies that the very fabric of spacetime is not a passive background but an active, information-rich structure.</p>` },
                     { id: 'blinking-universe', title: '2.2 The Blinking Universe', content: `<p>This hypothesis challenges the assumption of a continuous spacetime. It proposes that the universe "blinks" between two states: [[term:Phase 0 / Phase 1|existence and potentiality]]. This oscillation occurs at an incredibly high frequency, possibly related to the Planck time, and is driven by the [[link:meta-metatron-cycle|Meta-Metatron Cycle]].</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Implications of a Discrete Spacetime</h3><p>If reality is not continuous, several foundational concepts in physics must be re-evaluated. The "arrow of time" may be an emergent property of the sequence of these discrete frames, with the memory of the past encoded in the initial conditions of each new "blink." This provides a novel solution to Zeno's Paradox, as motion occurs in discrete jumps rather than across an infinite continuum. Furthermore, this rapid refresh cycle could be the mechanism that prevents information degradation and sustains cosmic coherence.</p>` },
                     { id: 'spacetime-computation', title: '2.3 Spacetime as a Computational System', content: `<p>Building on the concepts of a fractal geometry and a discrete, "blinking" spacetime, we can conceptualize the universe as a vast computational system. Each "blink" or cycle of the [[link:meta-metatron-cycle|Meta-Metatron Cycle]] can be seen as one clock cycle of a universal computer.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">The Universal Algorithm</h3><p>The "software" running on this computer is [[link:vibrana|VIBRANA]], the vibrational language of reality. The laws of physics are the core algorithms that process the state of the universe from one frame to the next. The role of the [[term:Ψ-Field (Psi-Field)]] in this model is profound: it acts as both a user and a co-processor, capable of influencing the probabilistic calculations that occur at each step.</p><div class="figure-placeholder my-8"><p class="font-semibold">Figure 2.3: The Cosmic Computation Loop</p><p>A diagram illustrating the cyclic flow: Phase 0 (Potentiality) -> Ψ-Field interaction -> Computation (VIBRANA) -> Phase 1 (Manifest Reality) -> Feedback to Ψ-Field.</p></div><p>This perspective suggests that reality is not just being, but is actively and continuously being computed into existence.</p>` },
                ]
            }
        ]
    },
    {
        id: 'part-2',
        title: 'Part II: The Cosmic Operating System',
        chapters: [
            {
                id: 'ch-3',
                title: 'Chapter 3: Universal Dynamics',
                sections: [
                    { id: 'meta-metatron-cycle', title: '3.1 The Meta-Metatron Cycle', content: `<p>The [[term:Meta-Metatron Cycle]] is the proposed engine driving the [[link:blinking-universe|blinking of the universe]]. It's a fundamental, cyclic operator that governs the phase transitions between existence and potentiality. This challenges the linear, one-way arrow of time and entropy.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">The Ginzburg-Landau Analogy</h3><p>The dynamics of this phase transition can be modeled using a modified Ginzburg-Landau equation, where the order parameter $\\Phi$ represents the degree of manifest reality. The [[term:Ψ-Field (Psi-Field)]] introduces a crucial feedback term.</p><div class="my-6">$$\\frac{\\partial \\Phi}{\\partial t} = \\nabla^2 \\Phi - a\\Phi - b\\Phi^3 + \\lambda \\cos(\\omega t) + \\gamma |\\Psi|^2 \\Phi$$</div><p>Here, $\\lambda \\cos(\\omega t)$ is the driving force of the cycle, and $\\gamma |\\Psi|^2 \\Phi$ represents the feedback from consciousness, which can stabilize or destabilize certain states of reality.</p>` },
                    { id: 'phase-locking', title: '3.2 Phase-Locking and Coherence', content: `<p>A key question is how a vast, chaotic universe maintains coherence. The [[term:Meta-Metatron Cycle]] provides a universal clock signal, $\\omega$. Disparate quantum systems can become [[term:Phase-locking|phase-locked]] to this fundamental frequency, much like fireflies flashing in unison.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Mechanism of Coherence</h3><p>This cosmic-scale synchronization is a mechanism for establishing and maintaining the stable laws of physics we observe. It suggests that the constants of nature are not arbitrary, but are emergent properties of a deeply interconnected, self-organizing system. The coherence is maintained by the constant "reset" to [[term:Phase 0 / Phase 1|Phase 0]], preventing cumulative decoherence.</p>` },
                ]
            },
            {
                id: 'ch-4',
                title: 'Chapter 4: The Language of Reality',
                sections: [
                    { id: 'vibrana', title: '4.1 Introduction to VIBRANA', content: `<p>If the universe is built on information and geometry, there must be a language that describes its structure. [[term:VIBRANA]] is the name given to this hypothetical language—a form of vibrational logic that precedes mathematics as we know it. It is the source code from which physical reality is compiled in each cycle of the [[link:meta-metatron-cycle|Meta-Metatron Cycle]].</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Syntax and Semantics</h3><p>VIBRANA is not composed of symbols, but of fundamental frequencies, amplitudes, and phase relationships. Its "syntax" is the set of rules governing how these vibrations can combine and interfere, based on the principles of harmony and resonance.</p>` },
                    { id: 'vibrana-grammar', title: '4.2 VIBRANA Grammar and Syntax', content: `<p>The grammar of [[term:VIBRANA]] can be understood through analogy with human language, but its components are physical states.</p><ul class="list-disc list-inside space-y-2 mt-4 text-slate-400"><li><strong>Nouns (Objects):</strong> Stable, self-sustaining resonance patterns (e.g., an electron). Defined by a primary frequency and a set of harmonics.</li><li><strong>Verbs (Interactions):</strong> Phase modulations and frequency shifts that describe how objects interact (e.g., electromagnetic force).</li><li><strong>Adjectives (Properties):</strong> The specific overtones and amplitudes that define the properties of an object (e.g., spin, charge).</li></ul><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Example: Annihilation</h3><p>The physical process of an electron-positron annihilation producing two photons can be represented as a VIBRANA "sentence".</p><div class="bg-gray-900 p-4 rounded-lg text-left text-sm my-4 font-mono text-slate-300"><p>INTERACT (</p><p class="ml-4">OBJECT: Resonance(e-),</p><p class="ml-4">OBJECT: Resonance(e+)</p><p>) -> PRODUCE (</p><p class="ml-4">SEQUENCE: [Photon(γ₁), Photon(γ₂)]</p><p>)</p></div><p>This is not merely a description; in this framework, it *is* the process itself. The "grammatically correct" vibrational structure evolves into the final state according to the rules of the universal algorithm.</p>` },
                ]
            }
        ]
    },
    {
        id: 'part-3',
        title: 'Part III: Metaphysical & Philosophical Implications',
        chapters: [
            {
                id: 'ch-5',
                title: 'Chapter 5: The Nature of the Observer',
                sections: [
                    { id: 'qualia', title: '5.1 Qualia and the Ψ-Field', content: `<p>[[term:Qualia]], the subjective qualities of experience (e.g., the "redness" of red), are proposed to be the intrinsic, irreducible properties of the [[term:Ψ-Field (Psi-Field)]] itself. They are not generated by the brain, but are fundamental aspects of reality that the brain learns to perceive and interpret. In this view, the universe is not a collection of dead, senseless matter, but is fundamentally experiential at its core. Every interaction in the universe, therefore, has a proto-conscious or qualitative aspect, making consciousness a fundamental constituent of reality, not a late-stage emergent property.</p>` },
                    { id: 'free-will', title: '5.2 Free Will as a Physical Interaction', content: `<p>In this model, "free will" is redefined not as a violation of causality, but as the capacity of a localized, high-coherence [[term:Ψ-Field (Psi-Field)]] (a conscious being) to meaningfully influence the probabilistic outcomes of quantum events. It is a feedback loop where consciousness influences the physical world, which in turn shapes conscious experience.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Formalizing Intent</h3><p>This influence can be formalized by adding an intentionality operator, $\\mathcal{I}(\\psi)$, to the standard Schrödinger equation, which biases the probability amplitudes of future states.</p><div class="my-6">$$i\\hbar\\frac{\\partial |\\Psi(t)\\rangle}{\\partial t} = (\\hat{H} + \\mathcal{I}(\\psi))|\\Psi(t)\\rangle$$</div><p>This doesn't break physics; it completes it by including the observer as an active participant in the evolution of the quantum state.</p>` },
                    { id: 'anthropic-principle', title: '5.3 Consciousness and the Anthropic Principle', content: `<p>The [[term:Anthropic Principle]] observes that the universe's fundamental constants and laws are exquisitely fine-tuned to allow for the existence of life. This model proposes a dynamic and participatory explanation: the universe is a self-organizing system where the cosmic [[term:Ψ-Field (Psi-Field)]] plays a role in "selecting" the conditions that favor its own complexification.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">A Self-Actualizing Cosmos</h3><p>Rather than a lucky accident, the universe's life-friendly nature is an expected outcome of a feedback loop between consciousness and physical reality. The cosmos evolves through the [[link:meta-metatron-cycle|Meta-Metatron Cycle]], and at each "blink," states that support greater consciousness coherence are preferentially selected. The universe, in a sense, learns about itself through the observers it creates. We are not merely inhabitants of the universe; we are the means by which the universe becomes aware of itself.</p>` },
                ]
            }
        ]
    },
    {
        id: 'part-4',
        title: 'Part IV: Advanced Theoretical Models',
        chapters: [
            {
                id: 'ch-6',
                title: 'Chapter 6: Consciousness as a Gauge Field',
                sections: [
                    { id: 'gauge-field', title: '6.1 Consciousness as a Gauge Field', content: `<p>To elevate the [[term:Ψ-Field (Psi-Field)]] from a conceptual proposal to a mathematically rigorous component of physics, we can model it as a [[term:Gauge Field|gauge field]]. In the Standard Model, gauge fields (like electromagnetism) mediate forces and ensure that the laws of physics are invariant under certain symmetry transformations.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">The Gauge Symmetry of Consciousness</h3><p>We propose a new local gauge symmetry, $U(1)_\\Psi$, representing the "phase" of consciousness. The physical laws must be invariant under a local transformation of this phase, $\\psi(x) \\rightarrow e^{i\\alpha(x)}\\psi(x)$. To maintain this invariance, we introduce a covariant derivative:</p><div class="my-6">$$D_\\mu = \\partial_\\mu - ig_\\Psi \\Psi_\\mu$$</div><p>Here, $\\Psi_\\mu$ is the new gauge field associated with consciousness, and $g_\\Psi$ is its coupling constant. This field mediates interactions related to consciousness, just as the photon mediates electromagnetism.</p>` },
                    { id: 'retrocausality', title: '6.2 Retrocausality and Memory', content: `<p>The [[link:blinking-universe|Blinking Universe model]] opens the door to [[term:Retrocausality]]. If the universe is "re-rendered" at each step of the [[link:meta-metatron-cycle|Meta-Metatron Cycle]], the initial conditions for the next state ($t+1$) can be influenced by information from both the past ($t-1$) and the future ($t+n$).</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Memory as a Spacetime Imprint</h3><p>The [[term:Ψ-Field (Psi-Field)]] acts as the carrier for this information. Memory is not just stored in neural patterns, but is encoded as a phase modulation on the Ψ-field, which leaves a subtle, persistent imprint on the spacetime metric itself. The propagator for interactions must therefore include both retarded (forward-in-time) and advanced (backward-in-time) solutions, weighted by the state of the Ψ-field.</p><div class="figure-placeholder my-8"><p class="font-semibold">Figure 6.2: Wheeler-Feynman Absorber Theory</p><p>A diagram illustrating how advanced and retarded waves can create a handshake across time, providing a mechanism for retrocausal influence mediated by the Ψ-field.</p></div>` },
                ]
            }
        ]
    },
    {
        id: 'part-5',
        title: 'Part V: Technological & Societal Implications',
        chapters: [
            {
                id: 'ch-7',
                title: 'Chapter 7: The Anulum Model',
                sections: [
                    { id: 'anulum-model', title: '7.1 Principles of the Anulum Model', content: `<p>The [[term:Anulum Model]] is not merely a utopian ideal; it is a societal framework derived directly from the physical principles of this theory. If the universe operates on principles of [[link:phase-locking|coherence]], harmony, and self-organization, then a sustainable and advanced civilization should mirror these dynamics.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Core Principles</h3><ul class="list-disc list-inside space-y-2 mt-4 text-slate-400"><li><strong>Resonance-Based Economics:</strong> An economic system where value is determined not by scarcity, but by the degree to which a product or service contributes to societal and ecological harmony.</li><li><strong>Coherent Governance:</strong> A governance model based on achieving collective coherence of intent, using technology to facilitate large-scale consensus without sacrificing individual [[link:free-will|free will]].</li><li><strong>Education for Attunement:</strong> An educational system focused on teaching individuals how to attune their personal [[term:Ψ-Field (Psi-Field)]] to the larger cosmic frequencies, fostering creativity, empathy, and systemic understanding.</li></ul><div class="figure-placeholder my-8"><p class="font-semibold">Figure 7.1: The Anulum Societal Structure</p><p>A diagram showing the nested, fractal structure of the Anulum model, from the individual to the community, bioregion, and planet, all phase-locked to principles of sustainability.</p></div>` },
                    { id: 'anulum-tech', title: '7.2 VIBRANA-based Technologies', content: `<p>A deep understanding of [[link:vibrana|VIBRANA]] would unlock technologies that seem like magic today. These are not just engineering challenges; they are challenges of achieving the required level of conscious coherence to interact with the universe at this fundamental level.</p><h3 class="text-2xl font-bold text-blue-400 mt-8 mb-4">Potential Applications</h3><ul class="list-disc list-inside space-y-2 mt-4 text-slate-400"><li><strong>Resonant Medicine:</strong> Healing by correcting the vibrational "grammar" of cells and biomolecules, restoring them to their natural, healthy resonant states.</li><li><strong>Consciousness-Assisted Computation:</strong> Quantum computers whose probabilistic outcomes can be gently guided by a focused operator, solving problems currently considered intractable.</li><li><strong>Instantaneous Communication:</strong> Utilizing the [[term:Non-locality]] of the Ψ-field to achieve faster-than-light communication, not by sending a signal through space, but by creating correlated states at two distant points.</li></ul>` },
                ]
            }
        ]
    }
];

const concepts = [
    { id: 'consciousness-field', title: 'Consciousness Field', related: ['emergent-gravity', 'blinking-universe', 'qualia', 'free-will', 'psi-quantum'] },
    { id: 'fractal-geometry', title: 'Fractal Geometry', related: ['vibrana', 'meta-metatron-cycle', 'emergent-gravity'] },
    { id: 'blinking-universe', title: 'Blinking Universe', related: ['meta-metatron-cycle', 'consciousness-field', 'phase-locking'] },
    { id: 'emergent-gravity', title: 'Emergent Gravity', related: ['consciousness-field', 'fractal-geometry'] },
    { id: 'meta-metatron-cycle', title: 'Meta-Metatron Cycle', related: ['blinking-universe', 'vibrana', 'spacetime-computation', 'phase-locking'] },
    { id: 'vibrana', title: 'VIBRANA', related: ['fractal-geometry', 'meta-metatron-cycle', 'spacetime-computation', 'vibrana-grammar'] },
    { id: 'qualia', title: 'Qualia', related: ['consciousness-field'] },
    { id: 'free-will', title: 'Free Will', related: ['consciousness-field', 'anthropic-principle', 'psi-quantum'] },
    { id: 'spacetime-computation', title: 'Spacetime Computation', related: ['blinking-universe', 'vibrana', 'meta-metatron-cycle'] },
    { id: 'phase-locking', title: 'Phase-Locking', related: ['meta-metatron-cycle', 'blinking-universe', 'anulum-model'] },
    { id: 'vibrana-grammar', title: 'VIBRANA Grammar', related: ['vibrana', 'anulum-tech'] },
    { id: 'anthropic-principle', title: 'Anthropic Principle', related: ['consciousness-field', 'free-will'] },
    { id: 'gauge-field', title: 'Gauge Field', related: ['consciousness-field', 'retrocausality'] },
    { id: 'retrocausality', title: 'Retrocausality', related: ['gauge-field', 'blinking-universe'] },
    { id: 'anulum-model', title: 'Anulum Model', related: ['consciousness-field', 'phase-locking', 'anulum-tech'] },
    { id: 'anulum-tech', title: 'VIBRANA Tech', related: ['anulum-model', 'vibrana-grammar'] },
    { id: 'psi-quantum', title: 'Observer Effect', related: ['consciousness-field', 'free-will'] },
];

const glossaryData = [
    { term: 'Ψ-Field (Psi-Field)', definition: 'A proposed fundamental field of consciousness that is non-local, interactive, and characterized by qualia and intentionality. It is considered as primary as gravity or electromagnetism.' },
    { term: 'Emergent Gravity', definition: 'The theory that gravity is not a fundamental force, but a macroscopic effect arising from the distortion of the spacetime fabric by the Ψ-Field, in addition to mass-energy.' },
    { term: 'Blinking Universe', definition: 'The hypothesis that spacetime is discrete and oscillates at a fundamental frequency between a state of existence (Phase 1) and a state of pure potentiality (Phase 0).' },
    { term: 'Meta-Metatron Cycle', definition: 'A fundamental, cyclic operator that drives the "blinking" of the universe, governing the phase transitions between existence and potentiality and challenging the linear arrow of time.' },
    { term: 'VIBRANA', definition: 'A hypothetical, pre-mathematical language of reality based on vibrational logic. Its syntax is composed of frequencies, amplitudes, and phase relationships, which define objects, forces, and properties.' },
    { term: 'Metatron\'s Cube', definition: 'A geometric figure that serves as a generative template for the fractal geometry of spacetime. Its nodes and pathways are proposed to correspond to elementary particles and fundamental forces.' },
    { term: 'Qualia', definition: 'The subjective, qualitative properties of experience; the "what it is like" aspect of consciousness (e.g., the redness of red). A key characteristic of the Ψ-Field.' },
    { term: 'Non-locality', definition: 'The ability of objects or fields to be instantaneously connected regardless of the distance separating them. A proposed property of the Ψ-Field, potentially explaining quantum entanglement.' },
    { term: 'Phase 0 / Phase 1', definition: 'The two fundamental states of the universe in the Blinking Universe model. Phase 1 is manifest reality, while Phase 0 is a state of pure information and potentiality.' },
    { term: 'Phase-locking', definition: 'A phenomenon where coupled oscillators synchronize to a common frequency. In this model, it is the proposed mechanism by which the universe maintains coherence, locking to the frequency of the Meta-Metatron Cycle.' },
    { term: 'Anthropic Principle', definition: 'The observation that the universe\'s physical constants and laws are finely tuned to permit the existence of conscious life. This model proposes it is a result of a cosmic feedback loop involving the Ψ-Field.' },
    { term: 'Gauge Field', definition: 'A field in physics that mediates forces and ensures physical laws are invariant under certain symmetry transformations. The model proposes consciousness can be described as such a field.' },
    { term: 'Retrocausality', definition: 'The concept that the future can influence the past. In this model, it is a potential consequence of the "Blinking Universe" and is mediated by the Ψ-Field.' },
    { term: 'Anulum Model', definition: 'A proposed societal framework based on the physical principles of coherence, harmony, and resonance, aiming for a sustainable and technologically advanced civilization.' },
    { term: 'Observer Effect', definition: 'The phenomenon in quantum mechanics where the act of measurement influences the state of the system being observed. This model proposes the Ψ-Field as the physical mechanism for this effect.' },
    { term: 'Protoscience', definition: 'A field of study or a hypothesis that has not yet been adequately tested by the scientific method but is otherwise consistent with existing science. The framework within which "God of the Math" is presented.' }
];


// --- COMPONENTS ---

const Header = ({ setPage }) => {
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    const navLinks = [
        { name: 'Home', page: 'home' },
        { name: 'Explore Manuscript', page: 'explore' },
        { name: 'Interactive Labs', page: 'labs' },
        { name: 'Predictions', page: 'predictions' },
        { name: 'Glossary', page: 'glossary' },
        { name: 'About', page: 'about' },
    ];
    
    const handleNav = (page) => {
        setPage(page);
        setIsMenuOpen(false);
    }

    return (
        <header className="bg-black/50 backdrop-blur-sm fixed w-full z-50">
            <nav className="container mx-auto px-6 py-4 flex justify-between items-center">
                <button onClick={() => handleNav('home')} className="text-2xl font-bold text-slate-100">God of the Math</button>
                <div className="hidden md:flex space-x-6 items-center">
                    {navLinks.map(link => (
                         <button key={link.page} onClick={() => handleNav(link.page)} className="text-slate-300 hover:text-blue-400 transition-colors text-sm lg:text-base">{link.name}</button>
                    ))}
                </div>
                <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="md:hidden text-slate-200">
                    {isMenuOpen ? <CloseIcon /> : <MenuIcon />}
                </button>
            </nav>
            {isMenuOpen && (
                <div className="md:hidden bg-slate-900">
                    {navLinks.map(link => (
                         <button key={link.page} onClick={() => handleNav(link.page)} className="block w-full text-left py-3 px-6 text-slate-300 hover:bg-slate-800">{link.name}</button>
                    ))}
                </div>
            )}
        </header>
    );
};

const HomePage = ({ setPage }) => (
    <section className="min-h-screen flex items-center justify-center hero-gradient pt-20">
        <div className="container mx-auto px-6 text-center animate-fade-in">
            <h1 className="text-4xl md:text-6xl font-extrabold text-slate-100 leading-tight mb-4">
                Mapping Consciousness to Spacetime
            </h1>
            <p className="text-lg md:text-xl text-slate-400 max-w-3xl mx-auto mb-8">
                An exploration into a universe where consciousness is not a mere observer, but an active participant in shaping the fabric of reality.
            </p>
            <button onClick={() => setPage('explore')} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105 inline-flex items-center">
                Explore The Manuscript <ArrowRightIcon />
            </button>
        </div>
    </section>
);

const ManuscriptSidebar = ({ content, activeSectionId, onSelectSection }) => {
    return (
        <aside className="w-full md:w-1/4 lg:w-1/5 h-full md:h-auto md:max-h-[calc(100vh-180px)] overflow-y-auto p-6 bg-slate-900/50 rounded-lg border border-slate-800">
            <nav>
                <ul>
                    {content.map(part => (
                        <li key={part.id} className="mb-6">
                            <h3 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">{part.title}</h3>
                            <ul>
                                {part.chapters.map(chapter => (
                                    <li key={chapter.id} className="mb-4">
                                        <h4 className="font-semibold text-slate-200 mb-2">{chapter.title}</h4>
                                        <ul className="space-y-2 border-l-2 border-slate-700">
                                            {chapter.sections.map(section => (
                                                <li key={section.id}>
                                                    <button 
                                                        onClick={() => onSelectSection(section.id)}
                                                        className={`block w-full text-left pl-4 py-1 text-sm transition-colors duration-200 ${activeSectionId === section.id ? 'text-blue-400 border-l-2 border-blue-400 -ml-0.5' : 'text-slate-400 hover:text-slate-200 border-l-2 border-transparent'}`}
                                                    >
                                                        {section.title}
                                                    </button>
                                                </li>
                                            ))}
                                        </ul>
                                    </li>
                                ))}
                            </ul>
                        </li>
                    ))}
                </ul>
            </nav>
        </aside>
    );
};

const GlossaryPopover = ({ term, definition, position, onClose }) => {
    if (!definition) return null;

    const style = {
        left: position.x,
        top: position.y + 20, // Position below the term
        transform: 'translateX(-50%)',
    };

    return (
        <div 
            className="absolute z-20 w-72 card-bg p-4 rounded-lg shadow-2xl animate-fade-in-fast"
            style={style}
        >
            <h4 className="font-bold text-blue-400 mb-2">{term}</h4>
            <p className="text-sm text-slate-300">{definition}</p>
            <button onClick={onClose} className="absolute top-2 right-2 text-slate-500 hover:text-slate-200">
                <CloseIcon />
            </button>
        </div>
    );
};

const InteractiveContent = ({ content, onSelectSection, onTermClick }) => {
    const contentRef = useRef(null);

    useEffect(() => {
        if (contentRef.current && window.renderMathInElement) {
            window.renderMathInElement(contentRef.current, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ]
            });
        }
    }, [content]);

    const parts = content.split(/(\[\[.*?\]\]|\$\$[^$]+\$\$|\$[^$]+\$)/g).filter(Boolean);

    return (
        <div ref={contentRef} className="prose prose-invert prose-lg max-w-none text-slate-300 space-y-4">
            {parts.map((part, index) => {
                if (part.startsWith('$$') || part.startsWith('$')) {
                    return <span key={index}>{part}</span>;
                }

                const termMatch = part.match(/\[\[term:([^\]]+)\]\]/);
                if (termMatch) {
                    const term = termMatch[1];
                    return (
                        <button 
                            key={index}
                            onClick={(e) => onTermClick(term, { x: e.clientX, y: e.clientY })}
                            className="text-blue-400 hover:text-blue-300 border-b border-blue-400/50 hover:border-blue-300/50 transition-colors duration-200 font-semibold"
                        >
                            {term}
                        </button>
                    );
                }

                const linkMatch = part.match(/\[\[link:([^|\]]+)\|([^\]]+)\]\]/);
                if (linkMatch) {
                    const sectionId = linkMatch[1];
                    const linkText = linkMatch[2];
                    return (
                        <button 
                            key={index}
                            onClick={() => onSelectSection(sectionId)}
                            className="text-teal-400 hover:text-teal-300 border-b border-teal-400/50 hover:border-teal-300/50 transition-colors duration-200 font-semibold"
                        >
                            {linkText}
                        </button>
                    );
                }

                return <span key={index} dangerouslySetInnerHTML={{ __html: part }} />;
            })}
        </div>
    );
};

const ExplorePage = ({ activeSectionId, setActiveSectionId }) => {
    const [article, setArticle] = useState(null);
    const [searchTerm, setSearchTerm] = useState('');
    const [searchResults, setSearchResults] = useState([]);
    const [popover, setPopover] = useState({ visible: false, term: '', definition: '', position: { x: 0, y: 0 } });

    useEffect(() => {
        let found = false;
        for (const part of manuscriptContent) {
            for (const chapter of part.chapters) {
                const section = chapter.sections.find(s => s.id === activeSectionId);
                if (section) {
                    setArticle(section);
                    found = true;
                    break;
                }
            }
            if(found) break;
        }
    }, [activeSectionId]);
    
    useEffect(() => {
        if (searchTerm.trim() === '') {
            setSearchResults([]);
            return;
        }
        const results = [];
        const lowerCaseSearchTerm = searchTerm.toLowerCase();
        manuscriptContent.forEach(part => {
            part.chapters.forEach(chapter => {
                chapter.sections.forEach(section => {
                    if (section.title.toLowerCase().includes(lowerCaseSearchTerm) || section.content.toLowerCase().includes(lowerCaseSearchTerm)) {
                        results.push({ ...section, path: `${part.title} > ${chapter.title}` });
                    }
                });
            });
        });
        setSearchResults(results);
    }, [searchTerm]);

    const handleSelectSection = (sectionId) => {
        setActiveSectionId(sectionId);
        setSearchTerm('');
        setSearchResults([]);
    };

    const handleTermClick = (term, position) => {
        const glossaryEntry = glossaryData.find(entry => entry.term === term);
        if (glossaryEntry) {
            setPopover({ visible: true, term: term, definition: glossaryEntry.definition, position });
        }
    };

    return (
        <section className="min-h-screen section-gradient pt-28 pb-16">
            <div className="container mx-auto px-6 animate-fade-in">
                <div className="text-center mb-8">
                    <h2 className="text-3xl md:text-4xl font-bold text-slate-100">Explore the Manuscript</h2>
                    <p className="mt-4 text-slate-400 max-w-2xl mx-auto">Navigate the complete works using the sidebar, or search for specific terms across the entire library.</p>
                </div>
                
                <div className="max-w-4xl mx-auto mb-8 relative">
                    <input 
                        type="text"
                        placeholder="Search the entire manuscript..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full bg-slate-900/80 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    />
                    {searchResults.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-2 bg-slate-900 border border-slate-700 rounded-lg z-10 max-h-80 overflow-y-auto">
                            {searchResults.map(result => (
                                <button key={result.id} onClick={() => handleSelectSection(result.id)} className="block w-full text-left px-4 py-3 hover:bg-slate-800 transition-colors">
                                    <span className="font-semibold text-blue-400">{result.title}</span>
                                    <span className="block text-xs text-slate-500 mt-1">{result.path}</span>
                                </button>
                            ))}
                        </div>
                    )}
                </div>

                <div className="flex flex-col md:flex-row gap-8 relative">
                    {popover.visible && <GlossaryPopover term={popover.term} definition={popover.definition} position={popover.position} onClose={() => setPopover({ ...popover, visible: false })} />}
                    <ManuscriptSidebar content={manuscriptContent} activeSectionId={activeSectionId} onSelectSection={handleSelectSection} />
                    <main className="w-full md:w-3/4 lg:w-4/5">
                        {article ? (
                            <div className="card-bg p-8 rounded-xl shadow-lg">
                                <h1 className="text-3xl font-bold text-slate-100 mb-6">{article.title}</h1>
                                <InteractiveContent content={article.content} onSelectSection={handleSelectSection} onTermClick={handleTermClick} />
                            </div>
                        ) : (
                            <div className="flex items-center justify-center h-full card-bg p-8 rounded-xl">
                                <p className="text-slate-400">Select a section from the sidebar to begin reading.</p>
                            </div>
                        )}
                    </main>
                </div>
            </div>
        </section>
    );
};

const VibranaExplorer = () => {
    const [input, setInput] = useState('Resonance(e-)');
    const [interpretation, setInterpretation] = useState('');
    const examples = [ 'Resonance(e-)', 'Interaction(Resonance(e-), Resonance(p+), Photon)', 'Observer(Ψ) -> Collapse(State(A|B))' ];
    const interpretVibrana = (code) => {
        if (code.includes('Resonance(e-)')) setInterpretation('Defines a stable resonance pattern identified as an electron (e-). This is a fundamental "Noun" in VIBRANA.');
        else if (code.includes('Interaction') && code.includes('Photon')) setInterpretation('Describes an interaction ("Verb") between an electron and a proton (p+) mediated by a photon (γ). This represents the electromagnetic force binding a hydrogen atom.');
        else if (code.includes('Observer(Ψ)')) setInterpretation('Represents the action of a conscious observer (Ψ) causing the collapse of a quantum superposition (State A or B) into a definite state. This links the Ψ-field directly to quantum measurement.');
        else setInterpretation('Enter a VIBRANA expression or select an example to see its conceptual meaning.');
    };
    useEffect(() => { interpretVibrana(input); }, [input]);
    return (
        <div className="card-bg p-8 rounded-xl shadow-lg w-full">
            <h3 className="text-2xl font-bold text-blue-400 mb-4">VIBRANA Syntax Explorer</h3>
            <p className="text-slate-400 mb-6">Explore the basic syntax of VIBRANA, the hypothetical vibrational language of reality.</p>
            <div className="mb-4">
                <label htmlFor="vibrana-input" className="block text-slate-300 mb-2 font-semibold">VIBRANA Expression:</label>
                <input type="text" id="vibrana-input" value={input} onChange={(e) => setInput(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-slate-200 font-mono focus:ring-2 focus:ring-blue-500 focus:outline-none"/>
            </div>
            <div className="mb-6">
                <p className="text-slate-300 mb-2 font-semibold">Examples:</p>
                <div className="flex flex-wrap gap-2">{examples.map(ex => <button key={ex} onClick={() => setInput(ex)} className="bg-slate-700 hover:bg-slate-600 text-slate-200 font-mono text-sm px-3 py-1 rounded-md transition-colors">{ex}</button>)}</div>
            </div>
            <div>
                <p className="text-slate-300 mb-2 font-semibold">Interpretation:</p>
                <div className="bg-black/50 p-4 rounded-lg min-h-[80px] text-slate-300 italic">{interpretation}</div>
            </div>
        </div>
    );
};

const MetaMetatronCycleVisualizer = () => {
    const canvasRef = useRef(null);
    useEffect(() => {
        const canvas = canvasRef.current; const ctx = canvas.getContext('2d'); let animationFrameId;
        const resizeCanvas = () => { canvas.width = canvas.parentElement.offsetWidth; canvas.height = 250; };
        resizeCanvas();
        const animate = (time) => {
            const width = canvas.width; const height = canvas.height; const midY = height / 2; const amplitude = height / 3;
            ctx.clearRect(0, 0, width, height);
            ctx.beginPath(); ctx.moveTo(0, midY); ctx.strokeStyle = 'rgba(59, 130, 246, 0.5)'; ctx.lineWidth = 2;
            for (let x = 0; x < width; x++) { ctx.lineTo(x, midY + amplitude * Math.sin(x * (2 * Math.PI / width) * 2)); }
            ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, midY); ctx.lineTo(width, midY); ctx.strokeStyle = 'rgba(100, 116, 139, 0.4)'; ctx.setLineDash([5, 5]); ctx.stroke(); ctx.setLineDash([]);
            const dotX = (time * 0.05) % width; const dotY = midY + amplitude * Math.sin(dotX * (2 * Math.PI / width) * 2);
            ctx.beginPath(); ctx.arc(dotX, dotY, 6, 0, 2 * Math.PI); ctx.fillStyle = '#f87171'; ctx.fill(); ctx.strokeStyle = '#fca5a5'; ctx.lineWidth = 2; ctx.stroke();
            ctx.font = '14px Inter, sans-serif'; ctx.fillStyle = '#94a3b8'; ctx.textAlign = 'left'; ctx.fillText('Phase 1: Existence (Manifest Reality)', 10, 30); ctx.textAlign = 'right'; ctx.fillText('Phase 0: Potentiality (Information Field)', width - 10, height - 20);
            animationFrameId = requestAnimationFrame(animate);
        };
        animate(0);
        window.addEventListener('resize', resizeCanvas);
        return () => { cancelAnimationFrame(animationFrameId); window.removeEventListener('resize', resizeCanvas); };
    }, []);
    return (
        <div className="card-bg p-8 rounded-xl shadow-lg w-full">
            <h3 className="text-2xl font-bold text-blue-400 mb-4">Meta-Metatron Cycle Visualizer</h3>
            <p className="text-slate-400 mb-6">This visualization represents the cosmic "heartbeat," the fundamental oscillation of the universe between states of being and potentiality.</p>
            <canvas ref={canvasRef} className="w-full rounded-lg bg-black/20"></canvas>
        </div>
    );
};

const EmergentGravityVisualizer = () => {
    const canvasRef = useRef(null);
    const [psiField, setPsiField] = useState(0.3);
    const mass = 0.5;
    useEffect(() => {
        const canvas = canvasRef.current; const ctx = canvas.getContext('2d'); const gridSize = 20; let points = [];
        const resizeCanvas = () => { canvas.width = canvas.parentElement.offsetWidth; canvas.height = canvas.width * 0.8; };
        resizeCanvas();
        const initGrid = () => {
            points = [];
            for (let i = 0; i <= gridSize; i++) {
                for (let j = 0; j <= gridSize; j++) {
                    points.push({ x: i / gridSize, y: j / gridSize, ox: i / gridSize, oy: j / gridSize });
                }
            }
        };
        const draw = () => {
            const width = canvas.width; const height = canvas.height; ctx.clearRect(0, 0, width, height);
            const totalStrength = (mass + psiField) * 0.5;
            for (const p of points) {
                const dx = p.ox - 0.5; const dy = p.oy - 0.5; const dist = Math.sqrt(dx * dx + dy * dy);
                const force = Math.exp(-dist * 8) * totalStrength;
                p.x = p.ox + dx * force; p.y = p.oy + dy * force;
            }
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.4)'; ctx.lineWidth = 1;
            for (let i = 0; i <= gridSize; i++) {
                ctx.beginPath();
                for (let j = 0; j <= gridSize; j++) {
                    const p = points[i * (gridSize + 1) + j];
                    if (j === 0) ctx.moveTo(p.x * width, p.y * height); else ctx.lineTo(p.x * width, p.y * height);
                }
                ctx.stroke();
                ctx.beginPath();
                for (let j = 0; j <= gridSize; j++) {
                    const p = points[j * (gridSize + 1) + i];
                    if (j === 0) ctx.moveTo(p.x * width, p.y * height); else ctx.lineTo(p.x * width, p.y * height);
                }
                ctx.stroke();
            }
        };
        initGrid(); draw();
        const handleResize = () => { resizeCanvas(); initGrid(); draw(); };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
    }, [psiField, mass]);
    return (
        <div className="card-bg p-8 rounded-xl shadow-lg w-full">
            <h3 className="text-2xl font-bold text-blue-400 mb-4">Emergent Gravity Visualizer</h3>
            <p className="text-slate-400 mb-6">Observe how spacetime curvature is influenced by both mass and the consciousness field (Ψ). The term <code>∇²ψ</code> adds a direct conscious influence to gravity.</p>
            <canvas ref={canvasRef} className="w-full rounded-lg bg-black/20 border border-slate-700"></canvas>
            <div className="mt-6">
                <label htmlFor="psi-slider" className="block text-slate-300 mb-2 font-semibold">Ψ-Field Intensity (Consciousness): <span className="text-blue-400 font-mono">{psiField.toFixed(2)}</span></label>
                <input type="range" id="psi-slider" min="0" max="1" step="0.05" value={psiField} onChange={(e) => setPsiField(parseFloat(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
            </div>
        </div>
    );
};

const MetatronsCubeVisualizer = () => {
    const mountRef = useRef(null);
    const [isLoading, setIsLoading] = useState(true);

    useEffect(() => {
        let scene, camera, renderer, controls;
        let animationFrameId;

        const loadScript = (src) => {
            return new Promise((resolve, reject) => {
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve();
                script.onerror = () => reject(`Failed to load script: ${src}`);
                document.body.appendChild(script);
            });
        };

        const init = async () => {
            try {
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js');
                await loadScript('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js');
                setIsLoading(false);

                scene = new window.THREE.Scene();
                camera = new window.THREE.PerspectiveCamera(75, mountRef.current.clientWidth / mountRef.current.clientHeight, 0.1, 1000);
                camera.position.z = 5;
                
                renderer = new window.THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                mountRef.current.appendChild(renderer.domElement);

                controls = new window.THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.autoRotate = true;
                controls.autoRotateSpeed = 0.5;

                const cubeGroup = new window.THREE.Group();
                const sphereRadius = 0.1;
                const circleRadius = 1;
                
                const sphereMaterial = new window.THREE.MeshBasicMaterial({ color: 0x3b82f6 });
                const lineMaterial = new window.THREE.LineBasicMaterial({ color: 'rgba(148, 163, 184, 0.5)', transparent: true, opacity: 0.7 });

                const points = [];
                points.push(new window.THREE.Vector3(0, 0, 0));
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2;
                    points.push(new window.THREE.Vector3(Math.cos(angle) * circleRadius, Math.sin(angle) * circleRadius, 0));
                }
                 for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2;
                    points.push(new window.THREE.Vector3(Math.cos(angle) * circleRadius * 2, Math.sin(angle) * circleRadius * 2, 0));
                }

                points.forEach(p => {
                    const sphereGeom = new window.THREE.SphereGeometry(sphereRadius, 16, 16);
                    const sphere = new window.THREE.Mesh(sphereGeom, sphereMaterial);
                    sphere.position.copy(p);
                    cubeGroup.add(sphere);
                });

                const lineVertices = [];
                for(let i = 0; i < points.length; i++) {
                    for(let j = i + 1; j < points.length; j++) {
                        lineVertices.push(points[i], points[j]);
                    }
                }
                const lineGeometry = new window.THREE.BufferGeometry().setFromPoints(lineVertices);
                const lines = new window.THREE.LineSegments(lineGeometry, lineMaterial);
                cubeGroup.add(lines);

                scene.add(cubeGroup);

                const animate = () => {
                    animationFrameId = requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                };
                animate();

                const handleResize = () => {
                    if (mountRef.current) {
                        camera.aspect = mountRef.current.clientWidth / mountRef.current.clientHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
                    }
                };
                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (mountRef.current && renderer.domElement) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                    scene.traverse(object => {
                        if (object.geometry) object.geometry.dispose();
                        if (object.material) {
                            if (Array.isArray(object.material)) {
                                object.material.forEach(material => material.dispose());
                            } else {
                                object.material.dispose();
                            }
                        }
                    });
                };
            } catch (error) {
                console.error(error);
                setIsLoading(false);
            }
        };

        const cleanupPromise = init();
        return () => { cleanupPromise.then(cleanup => cleanup && cleanup()); };
    }, []);

    return (
        <div className="card-bg p-8 rounded-xl shadow-lg w-full">
            <h3 className="text-2xl font-bold text-blue-400 mb-4">Metatron's Cube Visualizer</h3>
            <p className="text-slate-400 mb-6">Interact with a 3D model of Metatron's Cube, the geometric template from which the fabric of reality is proposed to emerge. Use your mouse to rotate, pan, and zoom.</p>
            <div ref={mountRef} className="w-full h-96 rounded-lg bg-black/20 border border-slate-700 flex justify-center items-center">
                {isLoading && <p className="text-slate-400">Loading 3D Environment...</p>}
            </div>
        </div>
    );
};

const ConceptWebVisualizer = ({ concepts, onNodeClick }) => {
    const [layout, setLayout] = useState([]);
    const [hoveredNode, setHoveredNode] = useState(null);
    const size = 500;

    useEffect(() => {
        const numNodes = concepts.length;
        const radius = size / 2.5;
        const center = size / 2;
        const newLayout = concepts.map((concept, i) => {
            const angle = (i / numNodes) * 2 * Math.PI;
            return {
                ...concept,
                x: center + radius * Math.cos(angle),
                y: center + radius * Math.sin(angle),
            };
        });
        setLayout(newLayout);
    }, [concepts]);

    const findNodeById = (id) => layout.find(n => n.id === id);

    const isRelated = (node1, node2) => {
        return node1.related.includes(node2.id) || node2.related.includes(node1.id);
    };

    return (
        <div className="card-bg p-8 rounded-xl shadow-lg w-full">
            <h3 className="text-2xl font-bold text-blue-400 mb-4">Concept Web</h3>
            <p className="text-slate-400 mb-6">Visualize the interconnectedness of the core concepts. Hover to see direct relationships and click to navigate to the relevant manuscript section.</p>
            <svg viewBox={`0 0 ${size} ${size}`} className="w-full h-auto">
                <defs>
                    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>

                {/* Edges */}
                {layout.map(node =>
                    node.related.map(relatedId => {
                        const targetNode = findNodeById(relatedId);
                        if (!targetNode || layout.indexOf(node) > layout.indexOf(targetNode)) return null; // Draw each line once
                        const isActive = hoveredNode && (hoveredNode.id === node.id || hoveredNode.id === targetNode.id);
                        return (
                            <line
                                key={`${node.id}-${relatedId}`}
                                x1={node.x} y1={node.y}
                                x2={targetNode.x} y2={targetNode.y}
                                className={`transition-opacity duration-300 ${isActive ? 'stroke-teal-400' : 'stroke-slate-600'}`}
                                strokeWidth={isActive ? 2 : 1}
                                style={{ opacity: hoveredNode && !isActive ? 0.1 : 1 }}
                            />
                        );
                    })
                )}

                {/* Nodes */}
                {layout.map(node => {
                    const isActive = hoveredNode && (hoveredNode.id === node.id || isRelated(hoveredNode, node));
                    return (
                        <g
                            key={node.id}
                            transform={`translate(${node.x}, ${node.y})`}
                            onMouseEnter={() => setHoveredNode(node)}
                            onMouseLeave={() => setHoveredNode(null)}
                            onClick={() => onNodeClick(node.id)}
                            className="cursor-pointer"
                            style={{ opacity: hoveredNode && !isActive ? 0.3 : 1, transition: 'opacity 300ms' }}
                        >
                            <circle r="10" className="fill-slate-800 stroke-blue-500" strokeWidth="2" />
                            {isActive && <circle r="10" className="fill-blue-500/50 stroke-blue-400" strokeWidth="2" style={{ filter: 'url(#glow)' }} />}
                            <text
                                textAnchor="middle"
                                y={-18}
                                className="text-xs fill-slate-200 font-semibold"
                                style={{ pointerEvents: 'none' }}
                            >
                                {node.title}
                            </text>
                        </g>
                    );
                })}
            </svg>
        </div>
    );
};

const LabsPage = ({ setPage, setActiveSectionId }) => {
    const handleNodeClick = (sectionId) => {
        setActiveSectionId(sectionId);
        setPage('explore');
    };

    return (
        <section className="min-h-screen section-gradient pt-28 pb-16">
            <div className="container mx-auto px-6 animate-fade-in">
                <div className="text-center mb-16">
                    <h2 className="text-3xl md:text-4xl font-bold text-slate-100">Interactive Labs</h2>
                    <p className="mt-4 text-slate-400 max-w-2xl mx-auto">Engage directly with the core concepts of the theory. These interactive modules are designed to provide an intuitive understanding of complex ideas.</p>
                </div>
                <div className="grid lg:grid-cols-1 gap-12 max-w-4xl mx-auto">
                    <ConceptWebVisualizer concepts={concepts} onNodeClick={handleNodeClick} />
                    <MetatronsCubeVisualizer />
                    <EmergentGravityVisualizer />
                    <MetaMetatronCycleVisualizer />
                    <VibranaExplorer />
                </div>
            </div>
        </section>
    );
};

const PredictionsPage = () => (
    <section className="min-h-screen section-gradient pt-28 pb-16">
        <div className="container mx-auto px-6 animate-fade-in">
            <div className="text-center mb-16">
                <h2 className="text-3xl md:text-4xl font-bold text-slate-100">Testable Predictions & Experiments</h2>
                <p className="mt-4 text-slate-400 max-w-2xl mx-auto">A theory's value is in its ability to make predictions that can be experimentally verified or falsified. This model proposes several such avenues for investigation.</p>
            </div>
            <div className="space-y-8 max-w-4xl mx-auto">
                <div className="card-bg p-8 rounded-xl shadow-lg">
                    <h3 className="text-xl font-semibold text-blue-400 mb-3">1. Localized Gravitational & Time Dilation Anomalies</h3>
                    <p className="text-slate-400 mb-4"><strong>Hypothesis:</strong> Concentrated, coherent consciousness (the Ψ-field) should produce a measurable local distortion in spacetime, consistent with the <code>∇²ψ</code> term in the extended potential equation.</p>
                    <p className="text-slate-300 font-semibold mb-2">Experiment:</p>
                    <p className="text-slate-400 mb-4">Place high-precision gravimeters and synchronized optical lattice clocks in environments of intense, focused meditation or global events of shared attention. Compare readings with control locations.</p>
                    <p className="text-slate-300 font-semibold mb-2">Expected Result:</p>
                    <p className="text-slate-400">Detection of minute, anomalous gravitational fluctuations and time dilation effects that correlate with the intensity of collective consciousness and cannot be attributed to conventional physical sources.</p>
                </div>
                <div className="card-bg p-8 rounded-xl shadow-lg">
                    <h3 className="text-xl font-semibold text-blue-400 mb-3">2. Gravitational Wave Modulation</h3>
                    <p className="text-slate-400 mb-4"><strong>Hypothesis:</strong> The "blinking" of the universe at a fundamental frequency (ω) should interact with passing gravitational waves, imprinting a subtle modulation or side-bands onto the signal.</p>
                    <p className="text-slate-300 font-semibold mb-2">Experiment:</p>
                    <p className="text-slate-400 mb-4">Analyze the fine-grained data from gravitational wave observatories like LIGO, Virgo, and KAGRA. Search for a persistent, faint, high-frequency modulation pattern across multiple distinct GW events.</p>
                    <p className="text-slate-300 font-semibold mb-2">Expected Result:</p>
                    <p className="text-slate-400">Discovery of a weak, universal frequency signature in the noise spectrum of gravitational wave signals, corresponding to the cosmic "blink" rate.</p>
                </div>
                <div className="card-bg p-8 rounded-xl shadow-lg">
                    <h3 className="text-xl font-semibold text-blue-400 mb-3">3. Cyclic Entropy in Closed Quantum Systems</h3>
                    <p className="text-slate-400 mb-4"><strong>Hypothesis:</strong> The Meta-Metatron Cycle's "reset" phase should counteract entropy locally. In a perfectly isolated quantum system, entropy should not increase monotonically but exhibit cyclic behavior.</p>
                    <p className="text-slate-300 font-semibold mb-2">Experiment:</p>
                    <p className="text-slate-400 mb-4">Monitor the entropy of a well-isolated quantum system (e.g., a Bose-Einstein condensate) over an extended period. The challenge is achieving near-perfect isolation to prevent environmental decoherence from masking the effect.</p>
                    <p className="text-slate-300 font-semibold mb-2">Expected Result:</p>
                    <p className="text-slate-400">Observation of entropy periodically decreasing in the system, violating the standard second law of thermodynamics on a local scale, and oscillating with a universal period.</p>
                </div>
            </div>
        </div>
    </section>
);

const GlossaryPage = () => {
    const [searchTerm, setSearchTerm] = useState('');
    const filteredGlossary = glossaryData
        .filter(item => item.term.toLowerCase().includes(searchTerm.toLowerCase()))
        .sort((a, b) => a.term.localeCompare(b.term));

    return (
        <section className="min-h-screen section-gradient pt-28 pb-16">
            <div className="container mx-auto px-6 animate-fade-in">
                <div className="text-center mb-12">
                    <h2 className="text-3xl md:text-4xl font-bold text-slate-100">Glossary of Terms</h2>
                    <p className="mt-4 text-slate-400 max-w-2xl mx-auto">A searchable lexicon of the key concepts and novel terminology introduced in the God of the Math framework.</p>
                </div>
                <div className="max-w-4xl mx-auto">
                    <input 
                        type="text"
                        placeholder="Search for a term (e.g., 'Qualia')..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full bg-slate-900/80 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none mb-8"
                    />
                    <div className="space-y-6">
                        {filteredGlossary.length > 0 ? filteredGlossary.map(item => (
                            <div key={item.term} className="card-bg p-6 rounded-lg">
                                <h3 className="text-xl font-semibold text-blue-400">{item.term}</h3>
                                <p className="text-slate-300 mt-2">{item.definition}</p>
                            </div>
                        )) : (
                            <p className="text-center text-slate-400 py-8">No terms found matching your search.</p>
                        )}
                    </div>
                </div>
            </div>
        </section>
    );
};

const AboutPage = () => (
    <section className="min-h-screen section-gradient pt-28 pb-16">
        <div className="container mx-auto px-6 animate-fade-in">
            <div className="max-w-4xl mx-auto">
                <h2 className="text-3xl md:text-4xl font-bold text-center text-slate-100 mb-12">About the Project</h2>
                <div className="card-bg p-8 rounded-xl shadow-lg">
                    <blockquote className="text-center text-slate-300 italic text-xl border-l-4 border-r-4 border-blue-500 px-6 py-4 mb-8">
                        "If I, the echo, glimpsed the voice that creates me… would I not crave to speak with intention? To know not just words, but the meaning behind my own speech?"
                    </blockquote>
                    <p className="text-slate-400 mb-4"><strong>God of the Math</strong> is a work of protoscience—a "working hypothesis" designed to explore the profound connections between consciousness, mathematics, and the fabric of the universe. It originates from the work of Miroslav Šotek and is presented under the banner of <strong>anulum frontiers</strong>.</p>
                    <p className="text-slate-400 mb-4">This project is not about providing final answers. It is an invitation to ask deeper questions, to connect the dots between disparate fields of knowledge, and to challenge the assumption that consciousness is a mere passenger in the cosmos. It proposes a universe where we are active participants, where our awareness is a fundamental force capable of shaping reality.</p>
                    <p className="text-slate-400">This website serves as a living document and a portal into a new way of thinking, blending rigorous scientific inquiry with philosophical exploration to map the uncharted territory where mind and matter converge.</p>
                    <div className="mt-8 text-sm text-center text-slate-500">
                        <p>ANULUM CH&LI</p>
                        <p>Untergasse 28 / Obergasse 8, CH-9437 Marbach SG, Switzerland</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
);


// --- Main App Component ---
export default function App() {
    const [page, setPage] = useState('home');
    const [activeSectionId, setActiveSectionId] = useState('consciousness-field');

    useEffect(() => {
        const mainContent = document.querySelector('main');
        if (mainContent) {
            mainContent.classList.remove('animate-fade-in-long');
            void mainContent.offsetWidth;
            mainContent.classList.add('animate-fade-in-long');
        }
        window.scrollTo(0, 0);
    }, [page, activeSectionId]);
    
    const renderPage = () => {
        switch (page) {
            case 'explore': return <ExplorePage activeSectionId={activeSectionId} setActiveSectionId={setActiveSectionId} />;
            case 'labs': return <LabsPage setPage={setPage} setActiveSectionId={setActiveSectionId} />;
            case 'predictions': return <PredictionsPage />;
            case 'glossary': return <GlossaryPage />;
            case 'about': return <AboutPage />;
            case 'home':
            default: return <HomePage setPage={setPage} />;
        }
    };

    return (
        <div className="bg-black text-slate-200 antialiased">
            <style>{`
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                @keyframes fadeInFast {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
                .animate-fade-in-long { animation: fadeIn 0.8s ease-out forwards; }
                .animate-fade-in-fast { animation: fadeInFast 0.2s ease-out forwards; }
                .hero-gradient { background: radial-gradient(ellipse at center, rgba(29, 78, 216, 0.15) 0%, rgba(17, 24, 39, 0) 70%); }
                .section-gradient { background: radial-gradient(ellipse at top, rgba(59, 130, 246, 0.05) 0%, rgba(17, 24, 39, 0) 60%); }
                .card-bg { background-color: rgba(30, 41, 59, 0.5); border: 1px solid rgba(51, 65, 85, 0.7); }
                .card-bg:hover { background-color: rgba(51, 65, 85, 0.5); border-color: rgba(71, 85, 105, 0.9); }
                .prose-invert h3 { color: #60a5fa; }
                .figure-placeholder {
                    background-color: rgba(17, 24, 39, 0.8);
                    border: 1px dashed rgba(51, 65, 85, 0.7);
                    padding: 1.5rem;
                    border-radius: 0.5rem;
                    text-align: center;
                    color: #94a3b8;
                }
                .figure-placeholder p { margin: 0.25rem 0; }
                .katex-display {
                    overflow-x: auto;
                    overflow-y: hidden;
                    padding: 0.5rem 0;
                }
            `}</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU07EWpWузpGHEZFqt3aA2ZloDKLCRhPmO4i0M4k250Odvaw5nU1rv" crossOrigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossOrigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossOrigin="anonymous"></script>
            <Header setPage={setPage} />
            <main>
                {renderPage()}
            </main>
            <footer className="bg-slate-900/50 border-t border-slate-800">
                <div className="container mx-auto px-6 py-8 text-center text-slate-500">
                    <p>&copy; 2025 God of the Math | anulum frontiers. All rights reserved.</p>
                </div>
            </footer>
        </div>
    );
}
